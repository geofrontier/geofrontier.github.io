<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GeoFrontier — Live World Map</title>
  
  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Main CSS -->
  <link rel="stylesheet" href="css/styles.css">
  
  <!-- Inline styles for map page -->
  <style>
    /* Hero section for map page */
    .map-hero {
      background: linear-gradient(rgba(2, 6, 23, 0.9), rgba(15, 23, 42, 0.85)), 
                  url('https://images.unsplash.com/photo-1534447677768-be436bb09401?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80');
      background-size: cover;
      background-position: center;
      color: white;
      text-align: center;
      padding: 80px 20px;
      margin-bottom: 30px;
      border-bottom: 2px solid var(--accent-gold);
    }
    
    .map-hero h1 {
      font-family: 'Cinzel', serif;
      font-size: 3.5rem;
      margin-bottom: 15px;
      color: var(--accent-gold);
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .map-hero p {
      font-size: 1.2rem;
      max-width: 800px;
      margin: 0 auto 25px;
      color: var(--text-light);
      opacity: 0.9;
    }
    
    /* Map container */
    .map-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .map-wrapper {
      position: relative;
      border-radius: 15px;
      overflow: hidden;
      border: 2px solid rgba(212, 175, 55, 0.3);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      background: var(--primary-dark);
      min-height: 600px;
    }
    
    .map-iframe {
      width: 100%;
      height: 600px;
      border: none;
      display: block;
    }
    
    .map-overlay {
      position: absolute;
      top: 15px;
      left: 15px;
      right: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 10;
      pointer-events: none;
    }
    
    .map-title {
      background: rgba(2, 6, 23, 0.8);
      color: var(--accent-gold);
      padding: 10px 20px;
      border-radius: 10px;
      font-family: 'Cinzel', serif;
      font-size: 1.2rem;
      border: 1px solid rgba(212, 175, 55, 0.3);
      backdrop-filter: blur(5px);
    }
    
    .map-controls {
      display: flex;
      gap: 10px;
      pointer-events: auto;
    }
    
    .map-btn {
      background: rgba(2, 6, 23, 0.8);
      color: var(--text-light);
      border: 1px solid rgba(212, 175, 55, 0.3);
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .map-btn:hover {
      background: rgba(212, 175, 55, 0.2);
      color: var(--accent-gold);
      border-color: var(--accent-gold);
    }
    
    /* Map info panel */
    .map-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .info-card {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 20px;
      border: 1px solid rgba(212, 175, 55, 0.2);
    }
    
    .info-card h3 {
      color: var(--accent-gold);
      margin-bottom: 15px;
      font-family: 'Cinzel', serif;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .info-card h3 i {
      font-size: 1.2rem;
    }
    
    .info-item {
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(212, 175, 55, 0.1);
      display: flex;
      justify-content: space-between;
    }
    
    .info-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .info-label {
      color: var(--text-muted);
      font-weight: 500;
    }
    
    .info-value {
      color: var(--text-light);
      font-weight: 600;
    }
    
    .info-value.online {
      color: #10b981;
    }
    
    .info-value.offline {
      color: #ef4444;
    }
    
    /* Legend */
    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 10px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
    }
    
    .legend-color {
      width: 15px;
      height: 15px;
      border-radius: 3px;
    }
    
    /* Loading state */
    .map-loading {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--primary-dark);
      color: var(--text-light);
      z-index: 5;
    }
    
    .map-loading i {
      font-size: 3rem;
      color: var(--accent-gold);
      margin-bottom: 20px;
    }
    
    /* Map tips */
    .map-tips {
      background: rgba(30, 41, 59, 0.5);
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
      border-left: 4px solid var(--accent-gold);
    }
    
    .map-tips h3 {
      color: var(--accent-gold);
      margin-bottom: 10px;
      font-family: 'Cinzel', serif;
    }
    
    .map-tips ul {
      padding-left: 20px;
      margin: 0;
    }
    
    .map-tips li {
      margin-bottom: 8px;
      color: var(--text-muted);
    }
    
    .map-tips li:last-child {
      margin-bottom: 0;
    }
    
    /* Responsive design */
    @media (max-width: 768px) {
      .map-hero h1 {
        font-size: 2.5rem;
      }
      
      .map-overlay {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }
      
      .map-controls {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .map-iframe {
        height: 500px;
      }
      
      .map-wrapper {
        min-height: 500px;
      }
      
      .map-title {
        text-align: center;
      }
    }
    
    @media (max-width: 480px) {
      .map-iframe {
        height: 400px;
      }
      
      .map-wrapper {
        min-height: 400px;
      }
      
      .map-hero {
        padding: 60px 20px;
      }
      
      .map-hero h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <!-- Navbar container -->
  <div id="navbar-container" class="component-loading">
    <i class="fas fa-spinner fa-spin"></i>
    <span>Loading navigation...</span>
  </div>
  
  <!-- Header container -->
  <div id="header-container" class="component-loading">
    <i class="fas fa-spinner fa-spin"></i>
    <span>Loading header...</span>
  </div>

  <!-- HERO SECTION -->
  <section class="map-hero">
    <h1>Live World Map</h1>
    <p>Explore the ever-changing landscape of GeoFrontier in real-time. Track player movements, discover settlements, and plan your next expedition.</p>
    <div class="hero-subtitle">Live Player Positions • Real-time Updates • Territory Boundaries • Settlement Markers</div>
  </section>

  <!-- MAIN CONTENT -->
  <div class="section">
    <!-- Map container -->
    <div class="map-container">
      <div class="map-wrapper">
        <!-- Loading overlay -->
        <div class="map-loading" id="map-loading">
          <i class="fas fa-compass fa-spin"></i>
          <h3>Loading Dynmap...</h3>
          <p>Connecting to the GeoFrontier world</p>
        </div>
        
        <!-- Map overlay controls -->
        <div class="map-overlay">
          <div class="map-title">
            <i class="fas fa-map"></i> GeoFrontier Dynmap
          </div>
          <div class="map-controls">
            <button class="map-btn" onclick="reloadMap()">
              <i class="fas fa-sync-alt"></i> Reload
            </button>
            <button class="map-btn" onclick="openFullscreen()">
              <i class="fas fa-expand"></i> Fullscreen
            </button>
            <button class="map-btn" onclick="copyMapLink()">
              <i class="fas fa-link"></i> Copy Link
            </button>
          </div>
        </div>
        
        <!-- Dynmap iframe -->
        <iframe 
          class="map-iframe" 
          id="dynmap-frame"
          src="http://216.173.77.69:25667/" 
          title="GeoFrontier Dynmap"
          allow="fullscreen"
          onload="mapLoaded()"
        ></iframe>
      </div>
      
      <!-- Map tips -->
      <div class="map-tips">
        <h3><i class="fas fa-lightbulb"></i> Map Navigation Tips</h3>
        <ul>
          <li><strong>Left-click and drag</strong> to move around the map</li>
          <li><strong>Scroll</strong> to zoom in and out</li>
          <li><strong>Right-click</strong> on players or markers for more information</li>
          <li>Use the <strong>layers menu</strong> (top-right) to toggle different map views</li>
          <li>Green markers indicate <strong>online players</strong>, gray markers show settlements</li>
        </ul>
      </div>
      
      <!-- Map info panel -->
      <div class="map-info">
        <div class="info-card">
          <h3><i class="fas fa-server"></i> Server Status</h3>
          <div class="info-item">
            <span class="info-label">Map Status:</span>
            <span class="info-value online" id="map-status">Online</span>
          </div>
          <div class="info-item">
            <span class="info-label">Players Online:</span>
            <span class="info-value" id="player-count">Loading...</span>
          </div>
          <div class="info-item">
            <span class="info-label">Last Updated:</span>
            <span class="info-value" id="last-updated">Just now</span>
          </div>
          <div class="info-item">
            <span class="info-label">World Size:</span>
            <span class="info-value">10,000×10,000 blocks</span>
          </div>
        </div>
        
        <div class="info-card">
          <h3><i class="fas fa-key"></i> Quick Links</h3>
          <div style="display: flex; flex-direction: column; gap: 10px;">
            <a href="http://216.173.77.69:25667/#world:GeoFrontier:0:64:0:0:0:0" class="btn btn-small" target="_blank">
              <i class="fas fa-home"></i> World Spawn
            </a>
            <a href="http://216.173.77.69:25667/#world:GeoFrontier:-500:64:500:-30:0:0" class="btn btn-small" target="_blank">
              <i class="fas fa-sun"></i} > Eastern Continent
            </a>
            <a href="http://216.173.77.69:25667/#world:GeoFrontier:500:64:-500:30:0:0" class="btn btn-small" target="_blank">
              <i class="fas fa-moon"></i> Western Isles
            </a>
            <button class="btn btn-small btn-outline" onclick="copyText('play.geofrontier.net')">
              <i class="fas fa-copy"></i> Copy Server IP
            </button>
          </div>
        </div>
        
        <div class="info-card">
          <h3><i class="fas fa-legend"></i> Map Legend</h3>
          <div class="legend">
            <div class="legend-item">
              <div class="legend-color" style="background: #10b981;"></div>
              <span>Online Players</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #6b7280;"></div>
              <span>Settlements</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #d4af37;"></div>
              <span>Important Locations</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #b7410e;"></div>
              <span>Danger Zones</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer container -->
  <div id="footer-container" class="component-loading" style="min-height: 150px;">
    <i class="fas fa-spinner fa-spin"></i>
    <span>Loading footer...</span>
  </div>

  <!-- COMPASS (BACK TO TOP) -->
  <div class="compass" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
    <i class="fas fa-compass"></i>
  </div>

  <!-- Load component loader -->
  <script src="js/components-loader.js"></script>
  
  <!-- Page-specific JavaScript -->
  <script>
    // ============================================
    // MAP PAGE FUNCTIONS
    // ============================================
    
    // Copy text function (reuse from other pages)
    window.copyText = window.copyText || function(text) {
      navigator.clipboard.writeText(text).then(() => {
        const notification = document.createElement('div');
        notification.textContent = `Copied: ${text}`;
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: var(--accent-gold);
          color: var(--primary-dark);
          padding: 12px 24px;
          border-radius: 8px;
          font-weight: 600;
          z-index: 1000;
          box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
          animation: fadeIn 0.3s ease;
        `;
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.style.animation = 'fadeOut 0.5s ease forwards';
          setTimeout(() => document.body.removeChild(notification), 500);
        }, 2000);
      }).catch(err => {
        console.error('Failed to copy:', err);
        alert(`Copy this: ${text}`);
      });
    };
    
    // Map functions
    function mapLoaded() {
      console.log('Dynmap loaded successfully');
      const loadingElement = document.getElementById('map-loading');
      if (loadingElement) {
        loadingElement.style.display = 'none';
      }
      
      // Update status
      document.getElementById('map-status').textContent = 'Online';
      document.getElementById('map-status').className = 'info-value online';
      
      // Start player count simulation
      updatePlayerCount();
      updateLastUpdated();
    }
    
    function reloadMap() {
      const mapFrame = document.getElementById('dynmap-frame');
      const loadingElement = document.getElementById('map-loading');
      
      if (loadingElement) {
        loadingElement.style.display = 'flex';
      }
      
      // Force reload
      mapFrame.src = mapFrame.src;
      
      // Show notification
      const notification = document.createElement('div');
      notification.textContent = 'Reloading map...';
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--accent-teal);
        color: var(--primary-dark);
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        z-index: 1000;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        animation: fadeIn 0.3s ease;
      `;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'fadeOut 0.5s ease forwards';
        setTimeout(() => document.body.removeChild(notification), 500);
      }, 2000);
    }
    
    function openFullscreen() {
      const mapFrame = document.getElementById('dynmap-frame');
      
      if (mapFrame.requestFullscreen) {
        mapFrame.requestFullscreen();
      } else if (mapFrame.webkitRequestFullscreen) {
        mapFrame.webkitRequestFullscreen();
      } else if (mapFrame.msRequestFullscreen) {
        mapFrame.msRequestFullscreen();
      }
      
      // Show notification
      const notification = document.createElement('div');
      notification.textContent = 'Press ESC to exit fullscreen';
      notification.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(2, 6, 23, 0.9);
        color: var(--accent-gold);
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
        z-index: 1000;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        animation: fadeIn 0.3s ease;
        border: 1px solid var(--accent-gold);
      `;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'fadeOut 0.5s ease forwards';
        setTimeout(() => document.body.removeChild(notification), 500);
      }, 3000);
    }
    
    function copyMapLink() {
      copyText('http://216.173.77.69:25667/');
    }
    
    // Simulate player count updates
    function updatePlayerCount() {
      const playerCountElement = document.getElementById('player-count');
      if (playerCountElement) {
        // Simulate player count (replace with actual API call if available)
        const basePlayers = Math.floor(Math.random() * 20) + 15;
        const variation = Math.floor(Math.random() * 8) - 4;
        const playerCount = Math.max(0, basePlayers + variation);
        
        playerCountElement.textContent = `${playerCount} players`;
        
        // Update every 30 seconds
        setTimeout(updatePlayerCount, 30000);
      }
    }
    
    // Update last updated timestamp
    function updateLastUpdated() {
      const lastUpdatedElement = document.getElementById('last-updated');
      if (lastUpdatedElement) {
        const now = new Date();
        const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        lastUpdatedElement.textContent = `${timeString}`;
        
        // Update every minute
        setTimeout(updateLastUpdated, 60000);
      }
    }
    
    // Check map connection status
    function checkMapStatus() {
      const mapFrame = document.getElementById('dynmap-frame');
      const statusElement = document.getElementById('map-status');
      
      // This is a basic check - for more accurate checking you'd need CORS access
      setTimeout(() => {
        const loadingElement = document.getElementById('map-loading');
        if (loadingElement && loadingElement.style.display !== 'none') {
          // Map still loading after 10 seconds
          statusElement.textContent = 'Slow Connection';
          statusElement.className = 'info-value offline';
          
          loadingElement.innerHTML = `
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Slow Connection Detected</h3>
            <p>The map is taking longer than usual to load</p>
            <button class="btn" onclick="reloadMap()" style="margin-top: 15px;">
              <i class="fas fa-sync-alt"></i> Try Again
            </button>
          `;
        }
      }, 10000);
    }
    
    // Initialize dropdowns if function exists
    function initDropdowns() {
      if (window.initializeDropdowns) {
        window.initializeDropdowns();
      }
    }
    
    // ============================================
    // PAGE INITIALIZATION
    // ============================================
    
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Map page loading...');
      
      // Start checking map status
      setTimeout(checkMapStatus, 5000);
      
      // Initialize player count and timestamp
      updatePlayerCount();
      updateLastUpdated();
      
      // Initialize dropdowns
      setTimeout(initDropdowns, 200);
      
      // Set active nav
      setTimeout(() => {
        const navLinks = document.querySelectorAll('.main-nav a[data-nav], nav a[data-nav]');
        navLinks.forEach(link => {
          if (link.getAttribute('data-nav') === 'map') {
            link.classList.add('active');
          }
        });
      }, 500);
    });
    
    // Listen for component loaded events
    document.addEventListener('componentLoaded', function(event) {
      if (event.detail.componentId === 'navbar') {
        setTimeout(initDropdowns, 100);
      }
    });
  </script>
</body>
</html>
