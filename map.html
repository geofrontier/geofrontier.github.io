<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GeoFrontier — Live World Map</title>
  
  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Main CSS -->
  <link rel="stylesheet" href="css/styles.css">
  
  <!-- Inline styles for map page -->
  <style>
    /* Hero section for map page */
    .map-hero {
      background: linear-gradient(rgba(2, 6, 23, 0.9), rgba(15, 23, 42, 0.85)), 
                  url('https://images.unsplash.com/photo-1534447677768-be436bb09401?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80');
      background-size: cover;
      background-position: center;
      color: white;
      text-align: center;
      padding: 80px 20px;
      margin-bottom: 30px;
      border-bottom: 2px solid var(--accent-gold);
    }
    
    .map-hero h1 {
      font-family: 'Cinzel', serif;
      font-size: 3.5rem;
      margin-bottom: 15px;
      color: var(--accent-gold);
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .map-hero p {
      font-size: 1.2rem;
      max-width: 800px;
      margin: 0 auto 25px;
      color: var(--text-light);
      opacity: 0.9;
    }
    
    .hero-subtitle {
      font-size: 1.1rem;
      color: var(--accent-teal);
      font-weight: 600;
      letter-spacing: 1px;
    }
    
    /* Map container */
    .map-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .map-wrapper {
      position: relative;
      border-radius: 15px;
      overflow: hidden;
      border: 2px solid rgba(212, 175, 55, 0.3);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      background: var(--primary-dark);
      min-height: 600px;
    }
    
    .map-iframe {
      width: 100%;
      height: 600px;
      border: none;
      display: block;
    }
    
    .map-overlay {
      position: absolute;
      top: 15px;
      left: 15px;
      right: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 10;
      pointer-events: none;
    }
    
    .map-title {
      background: rgba(2, 6, 23, 0.8);
      color: var(--accent-gold);
      padding: 10px 20px;
      border-radius: 10px;
      font-family: 'Cinzel', serif;
      font-size: 1.2rem;
      border: 1px solid rgba(212, 175, 55, 0.3);
      backdrop-filter: blur(5px);
    }
    
    .map-controls {
      display: flex;
      gap: 10px;
      pointer-events: auto;
    }
    
    .map-btn {
      background: rgba(2, 6, 23, 0.8);
      color: var(--text-light);
      border: 1px solid rgba(212, 175, 55, 0.3);
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .map-btn:hover {
      background: rgba(212, 175, 55, 0.2);
      color: var(--accent-gold);
      border-color: var(--accent-gold);
    }
    
    /* Map info panel */
    .map-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .info-card {
      background: var(--card-bg, #1e293b);
      border-radius: 10px;
      padding: 20px;
      border: 1px solid rgba(212, 175, 55, 0.2);
    }
    
    .info-card h3 {
      color: var(--accent-gold);
      margin-bottom: 15px;
      font-family: 'Cinzel', serif;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .info-item {
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(212, 175, 55, 0.1);
      display: flex;
      justify-content: space-between;
    }
    
    .info-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .info-label {
      color: var(--text-muted, #94a3b8);
      font-weight: 500;
    }
    
    .info-value {
      color: var(--text-light, #f1f5f9);
      font-weight: 600;
    }
    
    .info-value.online {
      color: #10b981;
    }
    
    .info-value.offline {
      color: #ef4444;
    }
    
    /* Legend */
    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 10px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      color: var(--text-light, #f1f5f9);
    }
    
    .legend-color {
      width: 15px;
      height: 15px;
      border-radius: 3px;
    }
    
    /* Loading state */
    .map-loading {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--primary-dark, #0b1120);
      color: var(--text-light, #f1f5f9);
      z-index: 5;
    }
    
    .map-loading i {
      font-size: 3rem;
      color: var(--accent-gold);
      margin-bottom: 20px;
    }
    
    /* Map tips */
    .map-tips {
      background: rgba(30, 41, 59, 0.5);
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
      border-left: 4px solid var(--accent-gold);
    }
    
    .map-tips h3 {
      color: var(--accent-gold);
      margin-bottom: 10px;
      font-family: 'Cinzel', serif;
    }
    
    .map-tips ul {
      padding-left: 20px;
      margin: 0;
    }
    
    .map-tips li {
      margin-bottom: 8px;
      color: var(--text-muted, #94a3b8);
    }
    
    .btn-small {
      display: inline-block;
      padding: 8px 16px;
      background: #2d3b4f;
      color: var(--text-light, #f1f5f9);
      text-decoration: none;
      border-radius: 6px;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      border: 1px solid rgba(212, 175, 55, 0.3);
      text-align: center;
    }
    
    .btn-small:hover {
      background: #3a4a62;
      border-color: var(--accent-gold);
      color: var(--accent-gold);
    }
    
    .btn-outline {
      background: transparent;
      border: 1px solid var(--accent-gold);
    }
    
    .btn-outline:hover {
      background: rgba(212, 175, 55, 0.1);
    }
    
    /* Component loading states */
    .component-loading {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 20px;
      background: rgba(30, 41, 59, 0.5);
      color: var(--text-muted);
      font-size: 0.9rem;
    }
    
    /* Responsive design */
    @media (max-width: 768px) {
      .map-hero h1 {
        font-size: 2.5rem;
      }
      
      .map-overlay {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }
      
      .map-controls {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .map-iframe {
        height: 500px;
      }
      
      .map-wrapper {
        min-height: 500px;
      }
    }
    
    @media (max-width: 480px) {
      .map-iframe {
        height: 400px;
      }
      
      .map-wrapper {
        min-height: 400px;
      }
      
      .map-hero h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <!-- Navbar container -->
  <div id="navbar-container" class="component-loading">
    <i class="fas fa-spinner fa-spin"></i>
    <span>Loading navigation...</span>
  </div>
  
  <!-- Header container -->
  <div id="header-container" class="component-loading">
    <i class="fas fa-spinner fa-spin"></i>
    <span>Loading header...</span>
  </div>

  <!-- HERO SECTION -->
  <section class="map-hero">
    <h1>Live World Map</h1>
    <p>Explore the ever-changing landscape of GeoFrontier in real-time. Track player movements, discover settlements, and plan your next expedition.</p>
    <div class="hero-subtitle">Live Player Positions • Real-time Updates • Territory Boundaries • Settlement Markers</div>
  </section>

  <!-- MAIN CONTENT -->
  <div class="section" style="max-width: 1400px; margin: 0 auto; padding: 0 20px;">
    <!-- Map container -->
    <div class="map-container">
      <div class="map-wrapper">
        <!-- Loading overlay -->
        <div class="map-loading" id="map-loading">
          <i class="fas fa-compass fa-spin"></i>
          <h3>Loading Dynmap...</h3>
          <p>Connecting to the GeoFrontier world</p>
        </div>
        
        <!-- Map overlay controls -->
        <div class="map-overlay">
          <div class="map-title">
            <i class="fas fa-map"></i> GeoFrontier Dynmap
          </div>
          <div class="map-controls">
            <button class="map-btn" onclick="reloadMap()">
              <i class="fas fa-sync-alt"></i> Reload
            </button>
            <button class="map-btn" onclick="openFullscreen()">
              <i class="fas fa-expand"></i> Fullscreen
            </button>
            <button class="map-btn" onclick="copyMapLink()">
              <i class="fas fa-link"></i> Copy Link
            </button>
          </div>
        </div>
        
        <!-- Dynmap iframe -->
        <iframe 
          class="map-iframe" 
          id="dynmap-frame"
          src="http://216.173.77.69:25667/" 
          title="GeoFrontier Dynmap"
          allow="fullscreen"
          onload="mapLoaded()"
          onerror="mapError()"
        ></iframe>
      </div>
      
      <!-- Map tips -->
      <div class="map-tips">
        <h3><i class="fas fa-lightbulb"></i> Map Navigation Tips</h3>
        <ul>
          <li><strong>Left-click and drag</strong> to move around the map</li>
          <li><strong>Scroll</strong> to zoom in and out</li>
          <li><strong>Right-click</strong> on players or markers for more information</li>
          <li>Use the <strong>layers menu</strong> (top-right) to toggle different map views</li>
          <li>Green markers indicate <strong>online players</strong>, gray markers show settlements</li>
        </ul>
      </div>
      
      <!-- Map info panel -->
      <div class="map-info">
        <div class="info-card">
          <h3><i class="fas fa-server"></i> Server Status</h3>
          <div class="info-item">
            <span class="info-label">Map Status:</span>
            <span class="info-value online" id="map-status">Connecting...</span>
          </div>
          <div class="info-item">
            <span class="info-label">Players Online:</span>
            <span class="info-value" id="player-count">Loading...</span>
          </div>
          <div class="info-item">
            <span class="info-label">Last Updated:</span>
            <span class="info-value" id="last-updated">Just now</span>
          </div>
          <div class="info-item">
            <span class="info-label">World Size:</span>
            <span class="info-value">10,000×10,000 blocks</span>
          </div>
        </div>
        
        <div class="info-card">
          <h3><i class="fas fa-key"></i> Quick Links</h3>
          <div style="display: flex; flex-direction: column; gap: 10px;">
            <a href="http://216.173.77.69:25667/#world:GeoFrontier:0:64:0:0:0:0" class="btn-small" target="_blank">
              <i class="fas fa-home"></i> World Spawn
            </a>
            <a href="http://216.173.77.69:25667/#world:GeoFrontier:-500:64:500:-30:0:0" class="btn-small" target="_blank">
              <i class="fas fa-sun"></i> Eastern Continent
            </a>
            <a href="http://216.173.77.69:25667/#world:GeoFrontier:500:64:-500:30:0:0" class="btn-small" target="_blank">
              <i class="fas fa-moon"></i> Western Isles
            </a>
            <button class="btn-small btn-outline" onclick="copyText('play.geofrontier.net')">
              <i class="fas fa-copy"></i> Copy Server IP
            </button>
          </div>
        </div>
        
        <div class="info-card">
          <h3><i class="fas fa-legend"></i> Map Legend</h3>
          <div class="legend">
            <div class="legend-item">
              <div class="legend-color" style="background: #10b981;"></div>
              <span>Online Players</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #6b7280;"></div>
              <span>Settlements</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #d4af37;"></div>
              <span>Important Locations</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #b7410e;"></div>
              <span>Danger Zones</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer container -->
  <div id="footer-container" class="component-loading">
    <i class="fas fa-spinner fa-spin"></i>
    <span>Loading footer...</span>
  </div>

  <!-- COMPASS (BACK TO TOP) -->
  <div class="compass" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
    <i class="fas fa-compass"></i>
  </div>

  <script>
    // ============================================
    // COMPONENT LOADER
    // ============================================
    
    class ComponentLoader {
      constructor() {
        this.components = {
          'navbar': 'components/navbar.html',
          'header': 'components/header.html',
          'footer': 'components/footer.html'
        };
        this.loadedComponents = 0;
        this.totalComponents = 3;
      }
    
      async loadComponent(componentId, targetElementId) {
        try {
          const componentPath = this.components[componentId];
          if (!componentPath) {
            console.error(`Component ${componentId} not found`);
            return;
          }
    
          console.log(`Loading component from: ${componentPath}`);
          
          // Add cache-busting query parameter
          const response = await fetch(`${componentPath}?t=${Date.now()}`);
          if (!response.ok) {
            throw new Error(`Failed to load ${componentPath}: ${response.status}`);
          }
    
          const html = await response.text();
          const targetElement = document.getElementById(targetElementId);
          
          if (targetElement) {
            targetElement.innerHTML = html;
            targetElement.classList.remove('component-loading');
            
            // Execute scripts within the component
            await this.executeScripts(targetElement);
            
            // Dispatch event for component-specific initialization
            document.dispatchEvent(new CustomEvent('componentLoaded', {
              detail: { componentId, targetElement }
            }));
            
            console.log(`Component ${componentId} loaded successfully`);
            
            this.loadedComponents++;
            if (this.loadedComponents === this.totalComponents) {
              document.dispatchEvent(new CustomEvent('allComponentsLoaded'));
            }
            
            return true;
          }
        } catch (error) {
          console.error(`Error loading component ${componentId}:`, error);
          this.showComponentError(targetElementId, componentId);
        }
      }
    
      async executeScripts(container) {
        const scripts = container.querySelectorAll('script');
        
        for (const oldScript of scripts) {
          const newScript = document.createElement('script');
          
          // Copy all attributes
          Array.from(oldScript.attributes).forEach(attr => {
            newScript.setAttribute(attr.name, attr.value);
          });
          
          if (oldScript.src) {
            // External script - load it
            await new Promise((resolve, reject) => {
              newScript.onload = resolve;
              newScript.onerror = reject;
              newScript.src = oldScript.src;
              document.head.appendChild(newScript);
            });
          } else {
            // Inline script - execute it
            newScript.textContent = oldScript.textContent;
            document.head.appendChild(newScript);
          }
        }
      }
    
      showComponentError(targetElementId, componentId) {
        const targetElement = document.getElementById(targetElementId);
        if (targetElement) {
          targetElement.innerHTML = `
            <div style="text-align: center; padding: 20px; background: #1e293b; color: #94a3b8;">
              <i class="fas fa-exclamation-triangle" style="color: #b7410e; font-size: 2rem; margin-bottom: 10px;"></i>
              <p>Failed to load ${componentId}</p>
              <button onclick="window.location.reload()" style="
                background: #d4af37;
                color: #0b1120;
                border: none;
                padding: 8px 16px;
                border-radius: 6px;
                cursor: pointer;
                margin-top: 10px;
                font-weight: 600;
              ">
                <i class="fas fa-redo"></i> Reload Page
              </button>
            </div>
          `;
        }
      }
    }
    
    // Initialize loader
    const loader = new ComponentLoader();
    
    // Load all components when page loads
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, loading components...');
      
      // Load components
      Promise.all([
        loader.loadComponent('navbar', 'navbar-container'),
        loader.loadComponent('header', 'header-container'),
        loader.loadComponent('footer', 'footer-container')
      ]).catch(error => {
        console.error('Error loading components:', error);
      });
    });
    
    // ============================================
    // MAP PAGE FUNCTIONS
    // ============================================
    
    // Copy text function
    window.copyText = function(text) {
      navigator.clipboard.writeText(text).then(() => {
        showNotification(`Copied: ${text}`);
      }).catch(err => {
        console.error('Failed to copy:', err);
        alert(`Copy this: ${text}`);
      });
    };
    
    // Show notification
    function showNotification(message, bgColor = '#d4af37') {
      const notification = document.createElement('div');
      notification.textContent = message;
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${bgColor};
        color: #0b1120;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        z-index: 10000;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        animation: fadeIn 0.3s ease;
      `;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'fadeOut 0.5s ease forwards';
        setTimeout(() => document.body.removeChild(notification), 500);
      }, 2000);
    }
    
    // Map functions
    function mapLoaded() {
      console.log('Dynmap loaded successfully');
      const loadingElement = document.getElementById('map-loading');
      if (loadingElement) {
        loadingElement.style.display = 'none';
      }
      
      document.getElementById('map-status').textContent = 'Online';
      document.getElementById('map-status').className = 'info-value online';
      
      updatePlayerCount();
      updateLastUpdated();
    }
    
    function mapError() {
      console.log('Dynmap failed to load');
      const loadingElement = document.getElementById('map-loading');
      if (loadingElement) {
        loadingElement.innerHTML = `
          <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i>
          <h3>Connection Error</h3>
          <p>Unable to connect to the map server</p>
          <p style="font-size: 0.9rem; margin-top: 10px;">The map may be offline or the address may be incorrect</p>
          <button onclick="reloadMap()" style="
            background: #d4af37;
            color: #0b1120;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 15px;
            font-weight: 600;
          ">
            <i class="fas fa-sync-alt"></i> Try Again
          </button>
        `;
      }
      
      document.getElementById('map-status').textContent = 'Offline';
      document.getElementById('map-status').className = 'info-value offline';
    }
    
    function reloadMap() {
      const mapFrame = document.getElementById('dynmap-frame');
      const loadingElement = document.getElementById('map-loading');
      
      if (loadingElement) {
        loadingElement.style.display = 'flex';
        loadingElement.innerHTML = `
          <i class="fas fa-compass fa-spin"></i>
          <h3>Loading Dynmap...</h3>
          <p>Connecting to the GeoFrontier world</p>
        `;
      }
      
      mapFrame.src = mapFrame.src;
      showNotification('Reloading map...');
    }
    
    function openFullscreen() {
      const mapFrame = document.getElementById('dynmap-frame');
      
      if (mapFrame.requestFullscreen) {
        mapFrame.requestFullscreen();
      } else if (mapFrame.webkitRequestFullscreen) {
        mapFrame.webkitRequestFullscreen();
      } else if (mapFrame.msRequestFullscreen) {
        mapFrame.msRequestFullscreen();
      }
      
      showNotification('Press ESC to exit fullscreen');
    }
    
    function copyMapLink() {
      copyText('http://216.173.77.69:25667/');
    }
    
    // Simulate player count updates
    function updatePlayerCount() {
      const playerCountElement = document.getElementById('player-count');
      if (playerCountElement) {
        const playerCount = Math.floor(Math.random() * 16) + 8;
        playerCountElement.textContent = `${playerCount} players`;
        setTimeout(updatePlayerCount, 30000);
      }
    }
    
    function updateLastUpdated() {
      const lastUpdatedElement = document.getElementById('last-updated');
      if (lastUpdatedElement) {
        const now = new Date();
        const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        lastUpdatedElement.textContent = timeString;
        setTimeout(updateLastUpdated, 60000);
      }
    }
    
    // Check map status after 10 seconds
    setTimeout(() => {
      const loadingElement = document.getElementById('map-loading');
      if (loadingElement && loadingElement.style.display !== 'none') {
        mapError();
      }
    }, 10000);
    
    // Add animation styles
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeOut {
        from { opacity: 1; transform: translateY(0); }
        to { opacity: 0; transform: translateY(-20px); }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>
